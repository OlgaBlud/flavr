# Appwrite Storage Setup для аватарок

## Шаги настройки:

### 1. Создание Storage Bucket

1. Зайдите в Appwrite Console: https://cloud.appwrite.io/
2. Откройте ваш проект
3. Перейдите в раздел **Storage** в боковом меню
4. Нажмите **Create Bucket**
5. Заполните:
   - **Bucket ID**: `avatars` (или любой другой ID)
   - **Name**: `Avatars`
   - **File size limit**: `5MB` (или больше по необходимости)
   - **Allowed file extensions**: `jpg, jpeg, png, webp`
   - **Compression**: `none` или `gzip` (по желанию)
   - **Encryption**: оставьте по умолчанию
   - **Antivirus**: оставьте по умолчанию

### 2. Настройка прав доступа (Permissions)

В настройках созданного bucket установите права:

**Read Access:**

- Role: `Any`
- Permission: `Read`

**Write Access:**

- Role: `Users`
- Permission: `Create`, `Update`, `Delete`

Это позволит:

- Всем видеть аватарки (для отображения в профилях)
- Только авторизованным пользователям загружать/обновлять свои аватарки

### 3. Добавление в .env (если нужно изменить ID)

Если вы использовали другой Bucket ID (не `avatars`), добавьте в ваш `.env.local`:

```env
EXPO_PUBLIC_APPWRITE_STORAGE_ID=ваш_bucket_id
```

Если ID = `avatars`, ничего добавлять не нужно, используется значение по умолчанию.

## Как это работает:

1. **Загрузка аватарки**:
   - Пользователь выбирает изображение через `ProfileTopBar`
   - Файл загружается в Appwrite Storage (bucket `avatars`)
   - URL файла сохраняется в поле `avatar` в таблице `users`

2. **Отображение аватарки**:
   - При загрузке пользователя из БД, берется URL из поля `avatar`
   - Изображение отображается через стандартный `<Image source={{ uri: avatar }}>`

3. **Обновление имени**:
   - Пользователь редактирует имя в `edit-profile.tsx`
   - Новое имя сохраняется в поле `userName` в таблице `users`
   - Обновляется в `auth.store.ts` для локального использования

## Структура таблицы users:

| Поле        | Тип    | Описание                                 |
| ----------- | ------ | ---------------------------------------- |
| `userId`    | string | ID из Appwrite Account                   |
| `userName`  | string | Имя пользователя                         |
| `userEmail` | string | Email                                    |
| `avatar`    | string | URL аватарки из Storage или initials URL |

## Troubleshooting:

**Ошибка при загрузке файла:**

- Проверьте права доступа bucket
- Убедитесь, что размер файла не превышает лимит
- Проверьте, что формат файла разрешен

**Аватарка не отображается:**

- Проверьте URL в БД
- Убедитесь, что bucket имеет права `Read` для `Any`
- Проверьте CORS настройки в Appwrite (для web)

**Изменения не сохраняются:**

- Проверьте подключение к интернету
- Посмотрите логи в консоли
- Убедитесь, что пользователь авторизован
